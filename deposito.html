<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificaci√≥n de Dep√≥sito de Misiles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Estilos generales de la aplicaci√≥n */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #64748b; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .chart-container { position: relative; width: 100%; max-width: 450px; margin-left: auto; margin-right: auto; height: 40vh; max-height: 450px; }
        .nav-link { display: flex; align-items: center; padding: 0.75rem 1.5rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; color: #e2e8f0; font-weight: 500; }
        .nav-link:hover { background-color: #334155; }
        .nav-link.active { background-color: #f59e0b; color: #1e293b; font-weight: 600; }
        .nav-link .icon { margin-right: 0.75rem; font-size: 1.25rem; }
        .custom-checkbox { appearance: none; width: 1.25rem; height: 1.25rem; border: 2px solid #64748b; border-radius: 0.25rem; background-color: #f1f5f9; cursor: pointer; position: relative; top: 4px; flex-shrink: 0; margin-right: 0.75rem; }
        .custom-checkbox:checked { background-color: #16a34a; border-color: #16a34a; }
        .custom-checkbox:checked::after { content: '\2713'; font-size: 0.875rem; color: white; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); font-weight: bold; }
        .report-header-text { color: #1f2937; }
        
        /* Estilo para transici√≥n suave del sidebar (SIN transform: translateX(0) base) */
        .sidebar {
            transition: transform 0.3s ease-in-out;
            /* En desktop, Tailwind y el flujo flex se encargan. No aplicar transform por defecto. */
        }
        
        /* Ocultar en m√≥vil y preparar para la animaci√≥n */
        @media (max-width: 767px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                z-index: 50; /* Por encima del contenido principal */
                transform: translateX(-100%); /* INICIALMENTE FUERA DE PANTALLA */
                box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
                /* Asegurar que el sidebar ocupe toda la altura cuando est√° fijo */
                height: 100%; 
            }
            .sidebar.active {
                transform: translateX(0); /* Mover a la vista al hacer clic */
            }
            .main-content {
                padding-top: 1rem;
            }
        }
        
        /* Estilos de impresi√≥n (Modo Reporte) - Conservados */
        @media print {
            /* Ocultar elementos de la interfaz */
            .no-print, .main-app-container .sidebar, .floating-btn { display: none !important; }
            /* Liberar el contenedor principal */
            .main-app-container { 
                display: block !important; 
                height: auto !important; 
                overflow: visible !important; 
            }
            /* Liberar Main y Reporte */
            .main-app-container .main-content, 
            .report-page-content {
                padding: 0 !important; 
                margin: 0 !important; 
                overflow: visible !important; 
                height: auto !important;
                flex: none !important;
                width: 100% !important;
                max-width: none !important;
                box-shadow: none !important;
                background-color: white !important;
            }
            /* Resetear la altura del cuerpo y HTML para permitir flujo */
            html, body {
                height: auto !important;
                overflow: visible !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            /* Reglas de tabla para paginaci√≥n (Chrome) */
            .report-table {
                font-size: 0.8rem !important; /* Fuente muy compacta */
                border-collapse: collapse !important;
                width: 100% !important;
                page-break-inside: auto !important;
            }
            .report-table th, .report-table td {
                border: 1px solid #e2e8f0 !important;
                padding: 0.3rem !important;
                line-height: 1.2 !important; 
            }
            .report-table thead { display: table-header-group !important; }
            .report-table tbody { display: table-row-group !important; }
            .report-table tr { page-break-inside: avoid !important; page-break-after: auto !important; }
            .header-container { page-break-after: avoid !important; }
            .footer-signature { page-break-before: avoid !important; }
        }
    </style>
</head>
<body class="bg-slate-100 font-sans">
    <!-- Chosen Palette: Slate and Amber -->
    <!-- Application Structure Plan: SPA con modo de Reporte integrado. El flujo de usuario es: 1) Exploraci√≥n (Inicio/Checklist), 2) Documentaci√≥n (Reporte). El dashboard fue actualizado para mostrar el Nivel de Cumplimiento en un panel grande. -->
    <!-- Visualization & Content Choices: 1. Estado (Donut Chart/Chart.js). 2. Checklist (Lista interactiva). 3. Reporte (Tabla HTML con iconos y estilos de impresi√≥n forzada). 4. Nuevo: Nivel de Cumplimiento (%) destacado en el dashboard. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <div class="flex h-screen overflow-hidden main-app-container">
        <!-- Sidebar: En m√≥vil (max-w-767px) es 'fixed' y est√° fuera de la vista por defecto. -->
        <!-- En desktop (md:), es parte del flujo flex. -->
        <nav id="sidebar" class="w-64 h-full bg-slate-800 text-slate-200 p-6 flex flex-col flex-shrink-0 sidebar md:flex">
            <div class="flex flex-col items-center mb-6">
                <img src="https://aaaes.fac.mil.co/sites/aaaes/files/IMAGENESAAAES/log_aaaes.png" alt="Logo AAAES" class="h-16 w-auto mb-2">
                <h1 class="text-2xl font-bold text-white text-center">AAAES</h1>
            </div>
            <ul class="space-y-3">
                <li><a href="#" class="nav-link active" data-page="inicio"><span class="icon">üìä</span>Inicio</a></li>
                <li><a href="#" class="nav-link" data-page="checklist"><span class="icon">‚úÖ</span>Lista de Chequeo</a></li>
                <li><a href="#" class="nav-link" data-page="sistemas"><span class="icon">üöÄ</span>Sistemas</a></li>
                <li><a href="#" class="nav-link" data-page="metodologia"><span class="icon">üìö</span>Metodolog√≠a</a></li>
                <li><a href="#" class="nav-link" data-page="reporte"><span class="icon">üìÑ</span>Reporte</a></li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto p-6 md:p-10 main-content">
            <div id="page-content"></div>
        </main>
    </div>

    <!-- Bot√≥n Flotante para Abrir/Cerrar la Navegaci√≥n en M√≥viles -->
    <!-- visible solo en m√≥vil (md:hidden) -->
    <button id="floating-nav-btn" 
            class="md:hidden floating-btn fixed bottom-3 right-3 z-50 p-4 bg-amber-500 text-white rounded-full shadow-lg hover:bg-amber-600 transition duration-300 transform active:scale-95"
            aria-label="Abrir navegaci√≥n">
        <!-- √çcono de men√∫ (tres barras) -->
        <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <!-- √çcono de cerrar (X) - Se alternar√° en JS -->
        <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
    </button>
    
    <!-- Overlay semitransparente para cerrar el men√∫ al hacer clic fuera (solo en m√≥vil) -->
    <div id="sidebar-overlay" class="md:hidden fixed inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-300 z-40"></div>

    <!-- Page Templates - Sin Cambios -->
    <template id="inicio-page">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-3xl font-bold text-slate-800 mb-6">Dashboard de Cumplimiento</h2>
            <p class="text-lg text-slate-600 mb-8">
                Este panel proporciona un resumen en tiempo real del estado de cumplimiento del dep√≥sito de misiles, basado en la lista de chequeo.
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-slate-500">
                    <h3 class="text-sm font-medium text-slate-500 uppercase">Total de √çtems</h3>
                    <p id="stat-total" class="text-3xl font-bold text-slate-800">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
                    <h3 class="text-sm font-medium text-slate-500 uppercase">Completados</h3>
                    <p id="stat-completed" class="text-3xl font-bold text-green-600">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-amber-500">
                    <h3 class="text-sm font-medium text-slate-500 uppercase">Pendientes</h3>
                    <p id="stat-pending" class="text-3xl font-bold text-amber-600">0</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">Estado General </h3>
                    <div class="chart-container">
                        <canvas id="complianceChart"></canvas>
                    </div>
                </div>

                <!-- Nuevo panel de Cumplimiento Destacado -->
                <div class="bg-white p-6 rounded-lg shadow-md flex flex-col justify-center items-center">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">Nivel de Cumplimiento</h3>
                    <div id="stat-percentage-display" class="text-6xl font-extrabold text-amber-500 transition-colors duration-500">
                        0.0%
                    </div>
                    <p class="text-slate-500 mt-2">del total de requisitos</p>
                </div>
                <!-- Fin del nuevo panel -->
            </div>

        </div>
    </template>

    <template id="checklist-page">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-3xl font-bold text-slate-800 mb-6">Lista de Chequeo de Almacenamiento</h2>
            <p class="text-lg text-slate-600 mb-6">
                Utilice esta lista para verificar todos los puntos cr√≠ticos para el almacenamiento seguro de los sistemas Python 5 y Derby. Marque cada √≠tem a medida que se verifica.
            </p>
            <div class="mb-6">
                <input id="checklist-filter" type="text" placeholder="Filtrar √≠tems..." class="w-full max-w-lg p-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-500">
            </div>
            <div id="checklist-container" class="space-y-8"></div>
        </div>
    </template>

    <template id="sistemas-page">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-3xl font-bold text-slate-800 mb-6">Sistemas de Armas</h2>
            <p class="text-lg text-slate-600 mb-8">
                Informaci√≥n de referencia sobre los sistemas de misiles cubiertos por esta lista de chequeo. Las condiciones de almacenamiento se derivan de sus especificaciones t√©cnicas.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-6 bg-slate-700">
                        <h3 class="text-2xl font-semibold text-white">PYTHON 5</h3>
                    </div>
                    <div class="p-6 space-y-4">
                        <p class="text-slate-700"><strong class="text-slate-800">Tipo:</strong> Misil Aire-Aire de 5¬™ Generaci√≥n (AAM).</p>
                        <p class="text-slate-700"><strong class="text-slate-800">Gu√≠a:</strong> Doble banda de im√°genes infrarrojas (IIR) y electro-√≥ptica.</p>
                        <p class="text-slate-700"><strong class="text-slate-800">Caracter√≠sticas:</strong> Alta maniobrabilidad (HOBS), capacidad de "enganche despu√©s del lanzamiento" (LOAL), esfera completa de ataque.</p>
                        <p class="text-slate-700"><strong class="text-slate-800">Consideraci√≥n Clave de Almacenamiento:</strong> Sensibilidad extrema del domo y los sensores IIR. Requiere control estricto de humedad y part√≠culas.</p>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-6 bg-slate-700">
                        <h3 class="text-2xl font-semibold text-white">DERBY / I-DERBY ER</h3>
                    </div>
                    <div class="p-6 space-y-4">
                        <p class="text-slate-700"><strong class="text-slate-800">Tipo:</strong> Misil Aire-Aire M√°s All√° del Alcance Visual (BVR-AAM).</p>
                        <p class="text-slate-700"><strong class="text-slate-800">Gu√≠a:</strong> Radar activo (seeker de radar definido por software en la versi√≥n ER).</p>
                        <p class="text-slate-700"><strong class="text-slate-800">Caracter√≠sticas:</strong> Capacidad "dispara y olvida", enlace de datos, modo "enganche antes del lanzamiento" (LOBL) y "despu√©s" (LOAL).</p>
                        <p class="text-slate-700"><strong class="text-slate-800">Consideraci√≥n Clave de Almacenamiento:</strong> Protecci√≥n del radomo y componentes electr√≥nicos sensibles al radar. Control de est√°tica (ESD) y temperatura.</p>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Plantilla de Metodolog√≠a - Sin Cambios -->
    <template id="metodologia-page">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-3xl font-bold text-slate-800 mb-6">Metodolog√≠a NATO (AECTP-600)</h2>
            <p class="text-lg text-slate-600 mb-8">
                Los par√°metros de esta lista de chequeo se derivan de la metodolog√≠a de 10 pasos de la NATO (AECTP-600), que asegura que las condiciones de almacenamiento simulan y protegen contra el ciclo de vida ambiental del material. Este m√©todo no es la lista en s√≠, sino el proceso cient√≠fico para definir los criterios de la lista.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 1:</strong> Definir el Prop√≥sito y Alcance del material.</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 2:</strong> Analizar el Ciclo de Vida Ambiental (desde f√°brica hasta uso).</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 3:</strong> Seleccionar las Pruebas Ambientales relevantes (Ej. T¬∞, Humedad, Vibraci√≥n).</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 4:</strong> Determinar la Secuencia de las Pruebas (Ej. T¬∞ antes de vibraci√≥n).</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 5:</strong> Definir Par√°metros y Severidad de las Pruebas (Ej. -20¬∞C a +50¬∞C).</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 6:</strong> Seleccionar el Equipo de Prueba (c√°maras clim√°ticas, mesas vibratorias).</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 7:</strong> Preparar el Plan de Prueba detallado.</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 8:</strong> Conducir las Pruebas seg√∫n el plan.</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 9:</strong> Analizar los Resultados y fallos (si los haya).</div>
                <div class="bg-white p-5 rounded-lg shadow-md"><strong class="text-amber-600">Paso 10:</strong> Documentar y Reportar los hallazgos.</div>
            </div>
        </div>
    </template>

    <!-- Plantilla de Reporte Integrado - Sin Cambios -->
    <template id="reporte-page">
        <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-xl report-page-content">
            <div class="mb-8 no-print">
                <button id="exit-report-btn" class="bg-slate-500 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition duration-300">
                    ‚Üê Volver a la Aplicaci√≥n
                </button>
                <button onclick="window.print()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition duration-300 ml-3">
                    üñ®Ô∏è Imprimir / Generar PDF
                </button>
            </div>

            <!-- Contenedor principal del encabezado COMPACTO -->
            <div class="header-container p-4 border-b-2 border-slate-300">
                
                <div class="flex items-center justify-between">
                    
                    <!-- Columna 1: Logo Izquierdo (h-16) -->
                    <img 
                        src="https://aaaes.fac.mil.co/sites/aaaes/files/IMAGENESAAAES/log_aaaes.png" 
                        alt="Logo AAAES" 
                        class="h-16 w-auto object-contain flex-shrink-0 mr-4">
                    
                    <!-- Columna 2: Texto Centrado y Estilizado (Fuentes peque√±as) -->
                    <div class="text-center flex-grow mx-4 max-w-2xl">
                        <h1 class="text-xl md:text-2xl font-extrabold text-[#1f2937] uppercase tracking-wide report-header-text">
                            AUTORIDAD AERON√ÅUTICA DE AVIACI√ìN DE ESTADO
                        </h1>
                        <p class="text-sm text-slate-600 font-medium mt-1">
                            Lista de chequeo de las condiciones de almacenamiento del dep√≥sito de armamento
                        </p>
                    </div>
                    
                    <!-- Columna 3: Logo Derecho (h-16) -->
                    <img 
                        src="https://www.epfac.edu.co/sites/emavi/files/imagenesemavi/escudo%20fac%20simbolos.jpg" 
                        alt="Logo FAC" 
                        class="h-16 w-auto object-contain flex-shrink-0 ml-4">
                        
                </div>
                
                <!-- Separador decorativo al pie del encabezado -->
                <div class="mt-4 pt-2 border-t-4 border-[#1f2937]">
                    <p class="text-xs text-slate-400 text-right">
                        Oficina de Certificaci√≥n Aeron√°utica
                    </p>
                </div>
                
            </div>

            <!-- Tabla de Resultados -->
            <h3 class="text-lg font-semibold mb-2 text-center pt-6 text-slate-800">Detalle de la Lista de Chequeo</h3>
            <table class="report-table w-full border-collapse mb-8 text-left">
                <thead>
                    <tr class="bg-slate-200">
                        <th class="p-1 w-1/12 text-xs text-center">ESTADO</th>
                        <th class="p-1 w-2/12 text-xs">CATEGOR√çA</th>
                        <th class="p-1 w-9/12 text-xs">DESCRIPCI√ìN DEL √çTEM</th>
                    </tr>
                </thead>
                <tbody id="reporte-table-body">
                    <!-- Contenido llenado por JS -->
                </tbody>
            </table>

            <!-- Pie de Firma -->
            <div class="grid grid-cols-2 gap-20 mt-8 pt-6 border-t border-slate-300 footer-signature">
                <div>
                    <p class="border-b-2 border-slate-600 h-8 mb-2"></p>
                    <p class="font-semibold text-left text-slate-800 text-sm">Nombre del Auditor</p>
                </div>
                <div>
                    <p class="border-b-2 border-slate-600 h-8 mb-2"></p>
                    <p class="font-semibold text-left text-slate-800 text-sm">Fecha</p>
                </div>
            </div>
        </div>
    </template>


    <script>
        // ... (El objeto appState y las funciones de helper se mantienen iguales, solo se actualiza la parte de DOM y eventos)
        const appState = {
            currentPage: 'inicio',
            isSidebarOpen: false, // Nuevo estado para controlar la visibilidad del sidebar en m√≥vil
            checklistItems: [
                { id: 'c1', text: 'Temperatura del dep√≥sito dentro del rango especificado (Ej. 15¬∞C - 25¬∞C).', category: 'Entorno y Clima', checked: false },
                { id: 'c2', text: 'Humedad relativa (HR) por debajo del umbral m√°ximo (Ej. 60%).', category: 'Entorno y Clima', checked: false },
                { id: 'c3', text: 'Sensores de Temperatura y HR operativos, calibrados y con registros.', category: 'Entorno y Clima', checked: false },
                { id: 'c4', text: 'Dep√≥sito limpio, sin polvo, escombros o contaminantes.', category: 'Entorno y Clima', checked: false },
                { id: 'c5', text: 'Ausencia de luz solar directa sobre los contenedores.', category: 'Entorno y Clima', checked: false },
                
                { id: 's1', text: 'Control de acceso restringido (biom√©trico, tarjeta, llave) funcionando.', category: 'Seguridad F√≠sica', checked: false },
                { id: 's2', text: 'Sistemas de videovigilancia (CCTV) internos y externos operativos y grabando.', category: 'Seguridad F√≠sica', checked: false },
                { id: 's3', text: 'Cerraduras, puertas y sellos de seguridad del dep√≥sito intactos y registrados.', category: 'Seguridad F√≠sica', checked: false },
                { id: 's4', text: 'Sistema de alarma de intrusi√≥n armado y operativo.', category: 'Seguridad F√≠sica', checked: false },
                { id: 's5', text: 'Rondas de seguridad perimetral e interna completadas y documentadas.', category: 'Seguridad F√≠sica', checked: false },
                
                { id: 'm1', text: 'Contenedores (CNU) de misiles sin da√±os, abolladuras o corrosi√≥n.', category: 'Manejo y Estiba', checked: false },
                { id: 'm2', text: 'Indicadores de humedad y golpe (ShockWatch) en contenedores revisados y en estado OK.', category: 'Manejo y Estiba', checked: false },
                { id: 'm3', text: 'Misiles estibados seg√∫n manual: distancias entre s√≠, altura de apilamiento correcta.', category: 'Manejo y Estiba', checked: false },
                { id: 'm4', text: 'Equipo de manejo (MONTACARGAS, gr√∫as) certificado y con inspecci√≥n diaria.', category: 'Manejo y Estiba', checked: false },
                { id: 'm5', text: 'Personal utilizando EPP (botas antiest√°ticas, guantes) en el √°rea.', category: 'Manejo y Estiba', checked: false },
                { id: 'm6', text: 'Conexi√≥n a tierra (grounding) de estanter√≠as y contenedores verificada.', category: 'Manejo y Estiba', checked: false },

                { id: 'd1', text: 'Registros (bit√°cora) de T¬∞ y HR diarios revisados y firmados.', category: 'Documentaci√≥n y Registros', checked: false },
                { id: 'd2', text: 'Hojas de vida (logbooks) de cada misil y contenedor actualizadas.', category: 'Documentaci√≥n y Registros', checked: false },
                { id: 'd3', text: 'Inventario f√≠sico coincide al 100% con el sistema (KARDEX/ERP).', category: 'Documentaci√≥n y Registros', checked: false },
                { id: 'd4', text: 'Manuales de procedimiento (SOP) y emergencia accesibles y actualizados.', category: 'Documentaci√≥n y Registros', checked: false },

                { id: 'e1', text: 'Sistema de detecci√≥n de incendios (humo, calor) con test funcional OK.', category: 'Sistemas de Emergencia', checked: false },
                { id: 'e2', text: 'Extintores apropiados (Ej. Tipo D para metales) cargados, en ubicaci√≥n y con inspecci√≥n vigente.', category: 'Sistemas de Emergencia', checked: false },
                { id: 'e3', text: 'Rutas de evacuaci√≥n y salidas de emergencia despejadas y se√±alizadas.', category: 'Sistemas de Emergencia', checked: false },
                { id: 'e4', text: 'Sistema de pararrayos (red de tierra) con medici√≥n de resistividad vigente.', category: 'Sistemas de Emergencia', checked: false },
                { id: 'e5', text: 'Luces de emergencia operativas.', category: 'Sistemas de Emergencia', checked: false }
            ],
        };

        let complianceChart = null;
        const mainAppContainer = document.querySelector('.main-app-container');
        const mainContent = document.querySelector('.main-content');
        const pageContent = document.getElementById('page-content');
        const sidebar = document.getElementById('sidebar'); 
        const navLinks = document.querySelectorAll('.nav-link');
        const floatingBtn = document.getElementById('floating-nav-btn');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const menuIcon = document.getElementById('menu-icon');
        const closeIcon = document.getElementById('close-icon');

        // Funci√≥n para alternar el estado del men√∫ en m√≥vil
        function toggleSidebar() {
            appState.isSidebarOpen = !appState.isSidebarOpen;
            sidebar.classList.toggle('active', appState.isSidebarOpen);
            
            // Alternar la visibilidad del overlay
            sidebarOverlay.classList.toggle('opacity-0', !appState.isSidebarOpen);
            sidebarOverlay.classList.toggle('pointer-events-none', !appState.isSidebarOpen);
            
            // Alternar los √≠conos del bot√≥n flotante
            menuIcon.classList.toggle('hidden', appState.isSidebarOpen);
            closeIcon.classList.toggle('hidden', !appState.isSidebarOpen);

            // Bloquear el scroll del body cuando el men√∫ est√° abierto
            // Solo aplicar si estamos en m√≥vil
            if (window.innerWidth < 768) {
                document.body.classList.toggle('overflow-hidden', appState.isSidebarOpen);
            }
        }

        // Funci√≥n para cerrar el men√∫ (usada al navegar o al tocar el overlay)
        function closeSidebar() {
            if (appState.isSidebarOpen && window.innerWidth < 768) {
                toggleSidebar();
            }
        }
        
        function updateDashboardStats(total, completed, pending) {
            const percentage = total > 0 ? ((completed / total) * 100).toFixed(1) : 0;
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-completed').textContent = completed;
            document.getElementById('stat-pending').textContent = pending;

            const percentageDisplay = document.getElementById('stat-percentage-display');
            if (percentageDisplay) {
                percentageDisplay.textContent = `${percentage}%`;
                // L√≥gica de color para el % de cumplimiento
                percentageDisplay.classList.remove('text-amber-500', 'text-orange-500', 'text-green-600');
                if (percentage >= 80) {
                    percentageDisplay.classList.add('text-green-600');
                } else if (percentage >= 50) {
                    percentageDisplay.classList.add('text-amber-500');
                } else {
                    percentageDisplay.classList.add('text-orange-500');
                }
            }
            return { completed, pending, percentage };
        }

        function initDashboard() {
            const total = appState.checklistItems.length;
            const completed = appState.checklistItems.filter(item => item.checked).length;
            const pending = total - completed;

            updateDashboardStats(total, completed, pending);
            
            const canvas = document.getElementById('complianceChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            if (complianceChart) {
                complianceChart.destroy();
            }

            complianceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completados', 'Pendientes'],
                    datasets: [{
                        data: [completed, pending],
                        backgroundColor: [ '#16a34a', '#f59e0b' ],
                        borderColor: '#ffffff',
                        borderWidth: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { size: 14, family: 'sans-serif' }, color: '#334155' } },
                        tooltip: { enabled: true }
                    }
                }
            });
        }

        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            if (!container) return;

            const filterInput = document.getElementById('checklist-filter');
            const filterValue = filterInput ? filterInput.value.toLowerCase() : '';
            
            const filteredItems = appState.checklistItems.filter(item => 
                item.text.toLowerCase().includes(filterValue) || 
                item.category.toLowerCase().includes(filterValue)
            );

            const categories = [...new Set(filteredItems.map(item => item.category))];

            if (filteredItems.length === 0) {
                container.innerHTML = `<p class="text-slate-500">No se encontraron √≠tems con el filtro "${filterValue}".</p>`;
                return;
            }

            let html = '';
            categories.forEach(category => {
                html += `<div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold text-slate-800 mb-4 border-b pb-2">${category}</h3>
                            <ul class="space-y-3">`;
                
                filteredItems.filter(item => item.category === category).forEach(item => {
                    html += `<li>
                                <label for="${item.id}" class="flex items-start text-slate-700 cursor-pointer">
                                    <input type="checkbox" id="${item.id}" data-id="${item.id}" class="custom-checkbox" ${item.checked ? 'checked' : ''}>
                                    <span class="flex-1">${item.text}</span>
                                </label>
                            </li>`;
                });

                html += `</ul></div>`;
            });
            
            container.innerHTML = html;
        }
        
        function addChecklistListeners() {
            const filterInput = document.getElementById('checklist-filter');
            if (filterInput) {
                filterInput.addEventListener('input', renderChecklist);
            }

            const checklistContainer = document.getElementById('checklist-container');
            if (checklistContainer) {
                checklistContainer.addEventListener('change', (event) => {
                    if (event.target.type === 'checkbox') {
                        const itemId = event.target.dataset.id;
                        const item = appState.checklistItems.find(i => i.id === itemId);
                        if (item) {
                            item.checked = event.target.checked;
                            if (appState.currentPage === 'inicio') {
                                 const total = appState.checklistItems.length;
                                 const completed = appState.checklistItems.filter(i => i.checked).length;
                                 updateDashboardStats(total, completed, total - completed);
                                 
                                 if (complianceChart) {
                                     complianceChart.data.datasets[0].data = [completed, total - completed];
                                     complianceChart.update();
                                 }
                            }
                        }
                    }
                });
            }
        }

        function initChecklistPage() {
            // Aseg√∫rate de que el modo de reporte est√© desactivado al cargar la checklist
            disableReportMode();
            renderChecklist();
            addChecklistListeners();
        }

        function initReportePage() {
            // Activar el modo de reporte para pantalla completa
            enableReportMode();

            const tableBody = document.getElementById('reporte-table-body');
            if (!tableBody) return;
            
            let tableHTML = '';
            
            const sortedItems = appState.checklistItems.sort((a, b) => {
                if (a.category < b.category) return -1;
                if (a.category > b.category) return 1;
                return 0;
            });

            sortedItems.forEach(item => {
                const statusIcon = item.checked ? '‚òëÔ∏è' : '‚òê';
                
                tableHTML += `
                    <tr>
                        <td class="p-1 text-center text-lg">${statusIcon}</td>
                        <td class="p-1 text-sm">${item.category}</td>
                        <td class="p-1 text-sm">${item.text}</td>
                    </tr>
                `;
            });
            tableBody.innerHTML = tableHTML;

            const exitButton = document.getElementById('exit-report-btn');
            if (exitButton) {
                exitButton.addEventListener('click', () => {
                    renderPage('inicio');
                });
            }
        }

        function enableReportMode() {
            // 1. Ocultar el nav y bot√≥n flotante
            // En desktop, la clase 'hidden' y 'w-0' anular√°n el 'md:flex' y 'w-64'
            sidebar.classList.add('hidden', 'w-0', 'md:w-0', 'md:flex-shrink-0'); 
            sidebar.classList.remove('md:w-64', 'md:flex'); // Limpiar clases de desktop
            floatingBtn.classList.add('hidden'); 
            
            // 2. Liberar el contenedor principal de su flujo flex (desktop)
            mainAppContainer.classList.remove('flex');
            mainAppContainer.classList.add('block');
            
            // 3. Quitar restricciones de altura y scroll
            mainAppContainer.classList.remove('h-screen', 'overflow-hidden');
            mainContent.classList.remove('overflow-y-auto');
        }

        function disableReportMode() {
            // 1. Restaurar el flujo flex de la aplicaci√≥n (sidebar + main)
            mainAppContainer.classList.remove('block');
            mainAppContainer.classList.add('flex', 'h-screen', 'overflow-hidden');
            mainContent.classList.add('overflow-y-auto');
            
            // 2. Mostrar sidebar (restaurar clases de desktop y remover ocultaci√≥n)
            sidebar.classList.remove('hidden', 'w-0', 'md:w-0', 'md:flex-shrink-0'); 
            sidebar.classList.add('md:w-64', 'md:flex'); // Restaurar clases de desktop (w-64 est√° en el HTML, pero es buena pr√°ctica)

            // 3. Mostrar el bot√≥n flotante solo si es m√≥vil
            if (window.innerWidth < 768) {
                 // Asegurar que el bot√≥n est√© visible en m√≥vil al volver del reporte
                 floatingBtn.classList.remove('hidden'); 
            } else {
                 floatingBtn.classList.add('hidden'); 
            }
            
            // 4. Asegurarse de que est√© cerrado al volver de reporte
            closeSidebar(); 
        }

        function renderPage(pageId) {
            appState.currentPage = pageId;
            const template = document.getElementById(`${pageId}-page`);
            if (!template) return;
            
            pageContent.innerHTML = '';
            const newPage = template.content.cloneNode(true);
            pageContent.appendChild(newPage);

            navLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.page === pageId);
            });
            
            // Cerrar el sidebar despu√©s de navegar en m√≥vil
            if (window.innerWidth < 768) {
                closeSidebar();
            }
            
            // L√≥gica para inicializar la p√°gina
            if (pageId === 'inicio') {
                disableReportMode();
                initDashboard();
            } else if (pageId === 'checklist') {
                disableReportMode();
                initChecklistPage();
            } else if (pageId === 'reporte') {
                initReportePage();
            } else {
                disableReportMode();
            }
        }

        function handleNavClick(event) {
            event.preventDefault();
            const pageId = event.currentTarget.dataset.page;
            if (pageId !== appState.currentPage) {
                renderPage(pageId);
            }
        }
        
        // Funci√≥n para manejar el cambio de tama√±o de pantalla
        function handleResize() {
            const isMobile = window.innerWidth < 768;
            
            // Si es m√≥vil, asegurar que el bot√≥n es visible (a menos que estemos en modo reporte, pero eso lo maneja disable/enableReportMode)
            if (isMobile) {
                if (appState.currentPage !== 'reporte') {
                    floatingBtn.classList.remove('hidden');
                }
            } else {
                // Si es desktop, asegurar que el bot√≥n est√© siempre oculto
                floatingBtn.classList.add('hidden');
                
                // Si es desktop, asegurar que el sidebar est√° 'abierto' (por defecto) y cerrar el overlay/scroll
                sidebar.classList.remove('active');
                sidebarOverlay.classList.add('opacity-0', 'pointer-events-none');
                document.body.classList.remove('overflow-hidden');
                appState.isSidebarOpen = false;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderPage('inicio');
            navLinks.forEach(link => {
                link.addEventListener('click', handleNavClick);
            });
            
            // Inicializar la visibilidad del bot√≥n flotante en funci√≥n del tama√±o de pantalla
            handleResize();
            
            // A√±adir listener al bot√≥n flotante
            floatingBtn.addEventListener('click', toggleSidebar);
            // A√±adir listener al overlay para cerrar el men√∫
            sidebarOverlay.addEventListener('click', closeSidebar);
            
            // Listener para manejar cambios de tama√±o de pantalla
            window.addEventListener('resize', handleResize);
        });

    </script>
</body>
</html>
